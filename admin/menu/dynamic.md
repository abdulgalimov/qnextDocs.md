# Динамическое меню
[[toc]]

Динамическое меню - это меню, которое может подстраивать в процессе работы. Т.е. вы не создаете заранее кнопки которые будут отображаться в этом разделе меню. Вы с помощью переменной указываете в Триггере Раздела какие кнопки должны быть в этом разделе. Откройте настройки раздела и нажмите на кнопку ✏️Динамическое меню, в ответ бот попросит написать путь до переменной, напишите например `${localVar.menuData}`. Теперь в Триггер Раздела, создайте локальную переменную `menuData` следующего содержания:

![](./13.png)

Получить такой объект можно например с помощью **JSON** строки:
```json 
{
 "buttons": [[{
    "type": "callback",
    "dynamicId": 1,
    "title": "Button A"
   }, {
    "type": "callback",
    "dynamicId": 2,
    "id": 1273,
    "title": "Button B"
   }], [{
    "type": "url",
    "url": "https://qnext.app",
    "title": "qnext"
   }]
  ]
}
```

Валидировать и посмотреть JSON строку можно на сайте [https://jsonformatter.org/json-viewer](https://jsonformatter.org/json-viewer).

Или с помощью **YAML** строки:
```yaml 
buttons:
  - 
    - type: callback
      dynamicId: 1
      title: Button A
    - type: callback
      dynamicId: 2
      title: Button B
  - 
    - type: url
      title: open url
      url: https://qnext.app
```

Валидировать и посмотреть YAML строку можно на сайте [https://jsonformatter.org/yaml-viewer](https://jsonformatter.org/yaml-viewer).



И вы получите меню следующего вида:

![](./14.png)

Объект menuData может содержать следующие параметры:
* **buttons** - массив массивов кнопок.
* **openItemId** - id раздела который необходимо открыть. Чтобы открыть базовый раздел, укажите строку root.
* **openPageId** - id страницы, которую надо открыть, если был передан параметр openItemId. Если не указать - тогда откроется первая страница.
* **breakUpdate** - не показывать текущее меню, т.е. после выполнения, обновления раздела меню не произойдет.

Массив кнопок `buttons`, должен содержать объекты button с полями `title` и `type`. Поле type может принимать одно из значений:
* callback
* url
* inline
* login
* contact
* location

В зависимости от поля type должны так же присутствовать и другие поля.

## type: callback

В этом случае необходимо дополнительно передать следующие параметры:
* dynamicId - любой числовой идентификатор, который поможет идентифицировать кнопку, которую нажал пользователь. ⚠️Обязательно должен быть числом.
* id - здесь может быть ID раздела меню, который необходимо открыть, это может быть любой раздел текущего меню. Необязательный параметр, если не передать, откроется текущий раздел меню. ⚠️Обязательно должен быть числом.
* `buttonValue1, buttonValue2, buttonValue3, buttonValue4`: здесь можно передать 4 любых значений, которые будут вести себя как `кастомные Значения` в настройках меню. ⚠️Обязательно должен быть числом.

```json
{
  "type": "callback",
  "title": "callback-кнопка",
  "dynamicId": 123,
  "id": 321,
  "buttonValue1": 100,
  "buttonValue2": 200
}
```

После нажатия на такую кнопку, параметр `dynamicId` будет доступен в триггере раздела в переменной `${body.dynamicId}`.

## type: url

В этом случае необходимо передать параметры:
* url - ссылка, которую пользователь откроет при нажатии на кнопку

```json
{
  "type": "url",
  "title": "url-кнопка",
  "url": "https://qnext.app/docs"
}
```

## type: inline
Кнопка, которая запускает inline режим бота:
* query - строка, которая будет подставлена в поле ввода после открытия inline меню
* currentChat - открывать inline меню в текущем чате. Необходимо указать boolean значение. Необязательное значение.

```json
{
  "type": "inline",
  "title": "inline-кнопка",
  "query": "строка для поиска",
  "currentChat": true
}
```

## type: login
В этом случае необходимо передать параметры:
* url - ссылка, на которую будет отправлена авторизационная информация
```json
{
  "type": "login",
  "title": "login-кнопка",
  "url": "https://my-domen.com"
}
```

## type: contact
Кнопка, которая запросит у пользователя его контакты. Только для клавиатуры. У этой кнопки нет дополнительных параметров.
```json
{
  "type": "contact",
  "title": "Контакты"
}
```

## type: location
Кнопка, которая запросит у пользователя гео локацию. Только для клавиатуры. У этой кнопки нет дополнительных параметров.
```json
{
  "type": "location",
  "title": "Геолокация"
}
```

## type: startGroup
Кнопка, которая запустит окно выбора чата, в который автоматически будет добавлен бот.
* url - строка, которая будет передана платформе в момент добавления бота в чат
```json
{
  "type": "startGroup",
  "title": "Добавить в чат",
  "url": "add_chat" 
}
```
